import fetch from 'node-fetch';
import axios from 'axios';

let handler = async (m, { conn, text, usedPrefix, command }) => {
  let user = global.db.data.users[m.sender]; // Obtenemos el usuario de la DB

  let precio = 500; // ğŸ’° lo que cuesta usar el comando
  if (user.dinero < precio) {
    return m.reply(`âŒ No tienes suficiente dinero.\nNecesitas *${precio}* ğŸ’µ para usar este comando.\nTienes: *${user.dinero}*`);
  }

  // Restar dinero
  user.dinero -= precio;

  m.react('ğŸ•‘');

  let txt = `PackğŸ”¥ğŸ”¥ğŸ”¥\n> Se te descontÃ³ *${precio}* ğŸ’µ\n> Pon de nuevo *.pack* para mirar el siguiente âœ¨\n\nSaldo restante: *${user.dinero}* ğŸ’µ`;
  let img = 'https://delirius-apiofc.vercel.app/nsfw/girls';

  const textRandom = [
    "ğ™€ğ™©ğ™ğ™¦ğ™ªğ™šğ™©ğ™– ğ™‚ğ™šğ™£ğ™šğ™§ğ™–ğ™¡ ğ™“ *Sasuke*",
    "ğ™ˆğ™šğ™£ğ™˜ğ™ğ™¤ğ™£ ğ™‚ğ™šğ™£ğ™šğ™§ğ™–ğ™¡",
    "ğ™€ğ™©ğ™ğ™¦ğ™ªğ™šğ™©ğ™–ğ™£ğ™™ğ™¤ ğ™– ğ™¡ğ™¤ğ™¨ ğ™‰ğ™‹ğ˜¾"
  ];

  const imgRandom = [
    "https://iili.io/FKVDVAN.jpg",
    "https://iili.io/FKVbUrJ.jpg"
  ];

  const msjRandom = textRandom[Math.floor(Math.random() * textRandom.length)];
  const imgSelected = imgRandom[Math.floor(Math.random() * imgRandom.length)];
  const thumb = Buffer.from((await axios.get(imgSelected, { responseType: 'arraybuffer'})).data);

  const izumi = {
    key: { participants: "0@s.whatsapp.net", fromMe: false, id: "Halo"},
    message: {
      locationMessage: {
        name: msjRandom,
        jpegThumbnail: thumb,
        vcard:
          "BEGIN:VCARD\nVERSION:3.0\nN:;Unlimited;;;\nFN:Unlimited\nORG:Unlimited\nTITLE:\n" +
          "item1.TEL;waid=19709001746:+1 (970) 900-1746\nitem1.X-ABLabel:Unlimited\n" +
          "X-WA-BIZ-DESCRIPTION:ofc\nX-WA-BIZ-NAME:Unlimited\nEND:VCARD"
      }
    },
    participant: "0@s.whatsapp.net"
  };

  m.react('âœ…');
  conn.sendMessage(m.chat, { image: { url: img }, caption: txt }, { quoted: izumi });
};

handler.command = ['pack'];

export default handler;