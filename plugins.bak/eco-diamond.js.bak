let handler = async (m, { conn }) => {
  let user = global.db.data.users[m.sender]

  if (!user) return m.reply('Usuario no encontrado.')

  // Cantidad a intercambiar, ejemplo viene del comando
  // Supongamos que el comando es: !cambiar <cantidad>
  let args = m.text.trim().split` `
  if (args.length < 2) return m.reply('Usa: !cambiar <cantidad>')

  let cantidad = parseInt(args[1])
  if (isNaN(cantidad) || cantidad <= 0) return m.reply('Ingresa una cantidad vÃ¡lida.')

  // Ratio de cambio: 100 monedas = 1 diamante
  const ratio = 100

  let diamantesACambiar = Math.floor(cantidad / ratio)
  if (diamantesACambiar < 1) return m.reply(`Necesitas al menos ${ratio} monedas para obtener 1 diamante.`)

  if (user.dinero < cantidad) return m.reply('No tienes suficiente dinero para hacer este intercambio.')

  // Restar el dinero
  user.dinero -= cantidad

  // Sumar los diamantes equivalentes
  user.diamond = (user.diamond || 0) + diamantesACambiar

  m.reply(`Has cambiado ${cantidad} monedas por ${diamantesACambiar} diamante(s). Ahora tienes ${user.dinero} monedas y ${user.diamond} diamantes.`)
}

handler.command = /^cambiar$/i

export default handler